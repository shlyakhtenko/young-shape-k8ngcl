"use strict";(self.webpackChunkreact=self.webpackChunkreact||[]).push([[837],{3837:(e,l,a)=>{a.r(l),a.d(l,{default:()=>h});var s=a(2791),t=a(3022);function n(e){return[{name:"inputs",caption:"Input Column",query:e.name,fields:Object.entries(e.fields).map((e=>{let[l,a]=e;return{name:l,caption:a.caption,editable:a.editable,primary_key:a.primary_key,edit_type:a.edit_type,edit:!1,criteria:[],display_on_card:null,type:a.type}}))}]}function i(e,l,a){return{name:l,caption:a,query:e.name,fields:Object.entries(e.fields).map((e=>{let[l,a]=e;return{name:l,caption:a.caption,editable:a.editable,edit:!1,criteria:[],type:a.type,display_on_card:!0}}))}}function r(e,l,a,s){let t=[...new Set(l.map((e=>e.fields)).flat().filter((e=>e.edit)))].map((e=>e.name));console.log("compute_output: wip_fields = ",t,"query=",e);let n={name:a,caption:s,query:e.name,fields:Object.entries(e.fields).map((e=>{let[l,a]=e;return t.includes(l)||a.primary_key?{name:l,caption:a.caption,editable:a.editable,edit:!1,criteria:[],type:a.type,display_on_card:!0}:null})).filter((e=>null!=e))};return console.log("compute_outputs returning",n),n}var c=a(3360),o=a(184);const d=function(e){const l=e.siblings,a=e.setter,t=e.column_data,[n,i]=(0,s.useState)(e.local_fields?Object.keys(e.local_fields).length:0),r=3+Object.entries(t.fields).map((e=>{let[,l]=e;return l.criteria.length})).reduce(((e,l)=>Math.max(e,l)),0);return(0,o.jsxs)("div",{className:"column",children:[(0,o.jsxs)("label",{children:["Column:",(0,o.jsx)("input",{value:t.caption,onChange:e=>{let s=l.map((l=>l.name==t.name?{...t,caption:e.target.value}:l));a(s)}},"column_name")]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("table",{className:"fieldTable",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Field"}),e.use_field?(0,o.jsx)("th",{children:"Display?"}):"",e.edit_field?(0,o.jsx)("th",{children:"Edit?"}):"",console.log("numColumns=",r),Array.apply(null,new Array(r-2)).map(((e,l)=>(console.log("i=",l),(0,o.jsx)("th",{children:0==l?"Criteria":"...or..."},l))))]})}),(0,o.jsxs)("tbody",{children:[Object.entries(t.fields).map((s=>{let[,n]=s;return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:n.caption}),e.use_field?(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"checkbox",checked:n.display_on_card,onChange:e=>{let s=Object.entries(t.fields).map((l=>{let[,a]=l;return a.name==n.name?{...n,display_on_card:e.target.checked}:a})),i=l.map((e=>e.name==t.name?{...t,fields:s}:e));a(i)}},t.name+"_"+n.name+"_use")}):"",e.edit_field?(0,o.jsx)("td",{children:(0,o.jsx)("input",{type:"checkbox",checked:n.edit?1:0,disabled:!n.editable||n.primary_key,onChange:s=>{let i=Object.entries(t.fields).map((e=>{let[,l]=e;return l.name==n.name?{...n,edit:s.target.checked}:l})),r=l.map((e=>e.name==t.name?{...t,fields:i}:e));a(r),e.output_setter([])}},t.name+"_"+n.name+"_edit")}):"",[...n.criteria,[]].map(((e,s)=>(0,o.jsx)("td",{children:(0,o.jsx)("input",{onChange:e=>{let i=null;s!=Object.entries(n.criteria).length?i=Object.entries(t.fields).map((l=>{let[,a]=l;return a.name==n.name?{...n,criteria:n.criteria.map(((l,a)=>a!=s?l:[{op:e.target.value}]))}:a})):(console.log("got new criteria"),i=Object.entries(t.fields).map((l=>{let[,a]=l;return{...a,criteria:[...a.criteria,a.name==n.name?[{op:e.target.value}]:""]}}))),console.log("n=",s,i);let r=l.map((e=>e.name==t.name?{...t,fields:i}:e));console.log(r),a(r)},value:e[0]?e[0].op:""})},s)))]},"tr_"+n.name)})),(0,o.jsx)(o.Fragment,{children:e.local_fields?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("tr",{children:(0,o.jsx)("th",{className:"break",colSpan:r})}),(0,o.jsx)("tr",{children:(0,o.jsx)("th",{colSpan:r,className:"local_fields",children:(0,o.jsx)("h5",{children:(0,o.jsx)("b",{children:"Pipeline-only fields (not saved to PITS)"})})})}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Field"}),(0,o.jsx)("th",{children:"Field Type"}),(0,o.jsx)("th",{})]}),Object.entries(e.local_fields).map((l=>{let[a,s]=l;return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("input",{value:s.caption,className:"local_field_input",placeholder:"Field Name",onChange:l=>{var a,n;a=s.name,n=l.target.value,e.setter(e.siblings.map((e=>e.name==t.name?{...e,local_fields:{...e.local_fields,[a]:{...e.local_fields[a],caption:n}}}:e)))}})}),(0,o.jsx)("td",{children:(0,o.jsxs)("select",{value:s.edit_type,onChange:l=>{return a=s.name,n=l.target.value,void e.setter(e.siblings.map((e=>e.name==t.name?{...e,local_fields:{...e.local_fields,[a]:{...e.local_fields[a],edit_type:n}}}:e)));var a,n},children:[(0,o.jsx)("option",{value:"string",children:"Short text or Number"}),(0,o.jsx)("option",{value:"textarea",children:"Long text"}),(0,o.jsx)("option",{value:"select_yesno",children:"Yes/No"})]})}),(0,o.jsx)("td",{colSpan:r-2,children:(0,o.jsx)(c.Z,{variant:"warning",size:"sm",onClick:()=>{e.setter(e.siblings.map((e=>{return e.name==t.name?{...e,local_fields:(l=s.name,a=e.local_fields,delete a[l],a)}:e;var l,a})))},children:"Delete"})})]},a)})),(0,o.jsx)("tr",{children:(0,o.jsx)("td",{colSpan:r,className:"local_fields_add_button",children:(0,o.jsx)(c.Z,{onClick:()=>{console.log("add field","local_fields",e.local_fields,"siblings",e.siblings,"column name",t.name);let l=e.siblings.map((e=>e.name==t.name?{...e,local_fields:{...e.local_fields,["local_field"+n]:{caption:"",edit_type:"string",name:"local_field"+n,editable:!0,edit:!0}}}:e));i((e=>e+1)),console.log("siblings",e.siblings,"newsibligs",l),e.setter(e.siblings.map((l=>l.name==t.name?{...l,local_fields:{...l.local_fields,["local_field"+n+Object.entries(e.local_fields).length]:{caption:"",type:"string",name:"local_field"+n+Object.entries(e.local_fields).length,editable:!0,edit:!0}}}:l)))},children:"Add Field"})})})]}):null})]})]}),e.remove_button?(0,o.jsx)(c.Z,{onClick:()=>{let s=l.filter((l=>e.keep_column?(console.log("Datacolumn:","s.name=",l.name,"keep_column=",e.keep_column),l.name!=t.name||l.name==e.keep_column):l.name!=t.name));a(s)},children:"Delete Column"}):""]})]})};var u=a(2288),m=a(6638),p=a(7689);function h(e){let l=null;const a=(0,s.useContext)(t.O),[h,f]=(0,s.useState)([]),[x,b]=(0,s.useState)(null),[_,j]=(0,s.useState)([]),[v,y]=(0,s.useState)(null),[g,N]=(0,s.useState)([]),[k,C]=(0,s.useState)({}),[w,S]=(0,s.useState)([]),[q,F]=(0,s.useState)(!1),[I,Z]=(0,s.useState)([]),[O,P]=(0,s.useState)([]),[E,R]=(0,s.useState)(null);let T=null,L=null;if("new"!=e.pipeline){let e=(0,p.UO)();l=e.pipelineName,[T,L]=(0,s.useState)(l)}else l="Pipeline",[T,L]=(0,s.useState)("");const[V,z]=(0,s.useState)(l);return q||(()=>{const s="https://docs.ipam.ucla.edu/cocytus/get_data_sources.php?ipam_id="+a.ipam_id+"&session_token="+a.session_token;fetch(s,{mode:"cors",headers:{},method:"GET"}).then((a=>{a.json().then((a=>{console.log("pipeline_editor: got data",a);let s=null;"new"!=e.pipeline?(s=a.pipelines.find((e=>e.name==l)),console.log("pipeine editor: new_pipeline_data",s,"data.pipelines",a.pipelines,"looking for ",l)):s={name:"new",caption:"New Pipeline",data_source:a.data_sources[0].name,query:a.data_sources[0].available_queries[0].name,inputs:n(a.data_sources[0].available_queries[0]),local_fields:a.local_fields?a.local_fields:[]},R(s),f(a.data_sources);let t=a.data_sources.find((e=>e.name==s.data_source));console.log("new_data_source",t,"loaded=",q),b(t),C(t.available_queries.find((e=>e.name==s.inputs[0].query))),console.log("subqueries",t.available_queries[0],t.available_queries[0].available_sub_queries),P(t.available_queries.map((e=>({value:e.name,label:e.caption})))),j(t.available_queries.find((e=>e.name==s.inputs[0].query)).available_sub_queries?t.available_queries.find((e=>e.name==s.inputs[0].query)).available_sub_queries.map((e=>({value:e.name,label:e.caption}))):[]),y(s.sub_query),N(s.inputs),"new"!=e.pipeline?(S(s.wips),Z(s.outputs),z(s.caption)):(z(""),S([]),Z([])),F(!0)}))}))})(),(0,o.jsxs)("div",{className:"App",children:[(0,o.jsx)("nav",{children:(0,o.jsxs)(u.Z,{className:"Breadcrumb",children:[(0,o.jsx)(u.Z.Item,{href:"/malebolge/",children:"Home"}),(0,o.jsxs)(u.Z.Item,{active:!0,children:["Editing pipeline: ",V]})]})}),(0,o.jsx)("h1",{children:"Pipeline Editor"}),x&&E?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("label",{className:"pipelineName",children:["Pipeline name:",(0,o.jsx)(m.Z.Control,{type:"text",value:V,onChange:e=>{z(e.target.value),L(encodeURIComponent(e.target.value))}})]}),(0,o.jsxs)("div",{className:"preamble",children:[(0,o.jsxs)("label",{children:["Datasource:",(0,o.jsx)(m.Z.Select,{className:"data_selector",defaultValue:x.name,onChange:e=>{let l=e.target.value,a=h.filter((e=>e.name==l))[0];b(a),N(n(a.available_queries[0])),S([]),Z([]),P(a.available_queries.map((e=>({value:e.name,label:e.caption}))))},children:h.map((e=>(0,o.jsx)("option",{value:e.name,children:e.caption},e.name)))})]}),(0,o.jsxs)("label",{children:["Query:",(0,o.jsxs)(m.Z.Select,{className:"data_selector",defaultValue:k.name,onChange:e=>{let l=e.target.value,a=x.available_queries.filter((e=>e.name==l))[0];C(a),N(n(a)),j(a.available_sub_queries?a.available_sub_queries.map((e=>({value:e.name,label:e.caption}))):[]),y(null),console.log("set subqueries",a.available_sub_queries?a.available_sub_queries.map((e=>({value:e.name,label:e.caption}))):[]),S([]),Z([])},children:[console.log(k),O.map((e=>(0,o.jsx)("option",{value:e.value,children:e.label},e.value)))]})]}),(0,o.jsxs)("label",{children:["Output:",(0,o.jsxs)(m.Z.Select,{className:"data_selector",default_value:"",value:v,onChange:e=>{y(e.target.value)},children:[(0,o.jsx)("option",{value:null,children:"Entire output"}),_.map((e=>(0,o.jsx)("option",{value:e.value,children:e.label},e.value)))]})]})]}),(0,o.jsxs)("table",{className:"columntable",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsxs)("th",{children:[(0,o.jsx)("h2",{children:"Inputs"}),(0,o.jsx)("h4",{children:"New cards appear here"})]}),(0,o.jsxs)("th",{children:[(0,o.jsxs)("h2",{children:["To-Do's"," ",(0,o.jsx)(c.Z,{onClick:()=>{S([...w,i(k,"wip"+w.length+1,"")])},children:"Add Column"})]}),(0,o.jsx)("h4",{children:"Cards you are working on appear here"})]}),(0,o.jsxs)("th",{children:[(0,o.jsxs)("h2",{children:["Done"," ",(0,o.jsx)(c.Z,{onClick:()=>{Z([...I,r(k,w,"outputs"+I.length+1,"")])},children:"Add Column"})]}),(0,o.jsx)("h4",{children:"All cards should end up here"})]})]})}),(0,o.jsx)("tbody",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("div",{className:"columnset",children:(0,o.jsx)(d,{column_data:g[0],local_fields:g[0].local_fields?g[0].local_fields:{},siblings:g,setter:N,use_field:!0,edit_field:!1},"inputs")})}),(0,o.jsx)("td",{children:(0,o.jsx)("div",{className:"columnset",children:w.map((e=>(0,o.jsx)(d,{column_data:{...e,fields:e.fields},siblings:w,setter:S,remove_button:!0,output_setter:Z,use_field:!1,edit_field:!0},e.name)))})}),(0,o.jsx)("td",{children:(0,o.jsx)("div",{className:"columnset",children:I.map((e=>(0,o.jsx)(d,{column_data:e,siblings:I,remove_button:!0,setter:Z,use_field:!1,edit_field:!1},e.name)))})})]})})]}),(0,o.jsx)("hr",{}),(0,o.jsx)(c.Z,{disabled:0==I.length||""==V,onClick:()=>{let e={data_source:x.name,query:k.name,sub_query:v,sub_queries:_,name:T,caption:V,inputs:g,wips:w,outputs:I,local_fields:E.local_fields};const l={"Content-Type":"application/json"},s="https://docs.ipam.ucla.edu/cocytus/save_pipeline.php?ipam_id="+a.ipam_id+"&session_token="+a.session_token,t=JSON.stringify(e);console.log("saving pipline before fetch url=",s,"body=",t,"headers=",l),fetch(s,{headers:l,body:t,mode:"cors",method:"POST"}).then((e=>{e.text().then((e=>{alert("Saved pipeline . Got response: "+e)}))}))},children:"Save"}),(0,o.jsx)("hr",{})]}):(0,o.jsx)("div",{children:"Loading data sources..."})]})}},1701:(e,l,a)=>{a.d(l,{UI:()=>t,XW:()=>n});var s=a(2791);function t(e,l){let a=0;return s.Children.map(e,(e=>s.isValidElement(e)?l(e,a++):e))}function n(e,l){return s.Children.toArray(e).some((e=>s.isValidElement(e)&&e.type===l))}},6638:(e,l,a)=>{a.d(l,{Z:()=>A});var s=a(654),t=a.n(s),n=a(2007),i=a.n(n),r=a(2791),c=a(184);const o={type:i().string,tooltip:i().bool,as:i().elementType},d=r.forwardRef(((e,l)=>{let{as:a="div",className:s,type:n="valid",tooltip:i=!1,...r}=e;return(0,c.jsx)(a,{...r,ref:l,className:t()(s,"".concat(n,"-").concat(i?"tooltip":"feedback"))})}));d.displayName="Feedback",d.propTypes=o;const u=d;var m=a(4934),p=a(162);const h=r.forwardRef(((e,l)=>{let{id:a,bsPrefix:s,className:n,type:i="checkbox",isValid:o=!1,isInvalid:d=!1,as:u="input",...h}=e;const{controlId:f}=(0,r.useContext)(m.Z);return s=(0,p.vE)(s,"form-check-input"),(0,c.jsx)(u,{...h,ref:l,type:i,id:a||f,className:t()(n,s,o&&"is-valid",d&&"is-invalid")})}));h.displayName="FormCheckInput";const f=h,x=r.forwardRef(((e,l)=>{let{bsPrefix:a,className:s,htmlFor:n,...i}=e;const{controlId:o}=(0,r.useContext)(m.Z);return a=(0,p.vE)(a,"form-check-label"),(0,c.jsx)("label",{...i,ref:l,htmlFor:n||o,className:t()(s,a)})}));x.displayName="FormCheckLabel";const b=x;var _=a(1701);const j=r.forwardRef(((e,l)=>{let{id:a,bsPrefix:s,bsSwitchPrefix:n,inline:i=!1,reverse:o=!1,disabled:d=!1,isValid:h=!1,isInvalid:x=!1,feedbackTooltip:j=!1,feedback:v,feedbackType:y,className:g,style:N,title:k="",type:C="checkbox",label:w,children:S,as:q="input",...F}=e;s=(0,p.vE)(s,"form-check"),n=(0,p.vE)(n,"form-switch");const{controlId:I}=(0,r.useContext)(m.Z),Z=(0,r.useMemo)((()=>({controlId:a||I})),[I,a]),O=!S&&null!=w&&!1!==w||(0,_.XW)(S,b),P=(0,c.jsx)(f,{...F,type:"switch"===C?"checkbox":C,ref:l,isValid:h,isInvalid:x,disabled:d,as:q});return(0,c.jsx)(m.Z.Provider,{value:Z,children:(0,c.jsx)("div",{style:N,className:t()(g,O&&s,i&&"".concat(s,"-inline"),o&&"".concat(s,"-reverse"),"switch"===C&&n),children:S||(0,c.jsxs)(c.Fragment,{children:[P,O&&(0,c.jsx)(b,{title:k,children:w}),v&&(0,c.jsx)(u,{type:y,tooltip:j,children:v})]})})})}));j.displayName="FormCheck";const v=Object.assign(j,{Input:f,Label:b});a(2391);const y=r.forwardRef(((e,l)=>{let{bsPrefix:a,type:s,size:n,htmlSize:i,id:o,className:d,isValid:u=!1,isInvalid:h=!1,plaintext:f,readOnly:x,as:b="input",..._}=e;const{controlId:j}=(0,r.useContext)(m.Z);return a=(0,p.vE)(a,"form-control"),(0,c.jsx)(b,{..._,type:s,size:i,ref:l,readOnly:x,id:o||j,className:t()(d,f?"".concat(a,"-plaintext"):a,n&&"".concat(a,"-").concat(n),"color"===s&&"".concat(a,"-color"),u&&"is-valid",h&&"is-invalid")})}));y.displayName="FormControl";const g=Object.assign(y,{Feedback:u}),N=r.forwardRef(((e,l)=>{let{className:a,bsPrefix:s,as:n="div",...i}=e;return s=(0,p.vE)(s,"form-floating"),(0,c.jsx)(n,{ref:l,className:t()(a,s),...i})}));N.displayName="FormFloating";const k=N,C=r.forwardRef(((e,l)=>{let{controlId:a,as:s="div",...t}=e;const n=(0,r.useMemo)((()=>({controlId:a})),[a]);return(0,c.jsx)(m.Z.Provider,{value:n,children:(0,c.jsx)(s,{...t,ref:l})})}));C.displayName="FormGroup";const w=C;var S=a(1424);const q=r.forwardRef(((e,l)=>{let{bsPrefix:a,className:s,id:n,...i}=e;const{controlId:o}=(0,r.useContext)(m.Z);return a=(0,p.vE)(a,"form-range"),(0,c.jsx)("input",{...i,type:"range",ref:l,className:t()(s,a),id:n||o})}));q.displayName="FormRange";const F=q,I=r.forwardRef(((e,l)=>{let{bsPrefix:a,size:s,htmlSize:n,className:i,isValid:o=!1,isInvalid:d=!1,id:u,...h}=e;const{controlId:f}=(0,r.useContext)(m.Z);return a=(0,p.vE)(a,"form-select"),(0,c.jsx)("select",{...h,size:n,ref:l,className:t()(i,a,s&&"".concat(a,"-").concat(s),o&&"is-valid",d&&"is-invalid"),id:u||f})}));I.displayName="FormSelect";const Z=I,O=r.forwardRef(((e,l)=>{let{bsPrefix:a,className:s,as:n="small",muted:i,...r}=e;return a=(0,p.vE)(a,"form-text"),(0,c.jsx)(n,{...r,ref:l,className:t()(s,a,i&&"text-muted")})}));O.displayName="FormText";const P=O,E=r.forwardRef(((e,l)=>(0,c.jsx)(v,{...e,ref:l,type:"switch"})));E.displayName="Switch";const R=Object.assign(E,{Input:v.Input,Label:v.Label}),T=r.forwardRef(((e,l)=>{let{bsPrefix:a,className:s,children:n,controlId:i,label:r,...o}=e;return a=(0,p.vE)(a,"form-floating"),(0,c.jsxs)(w,{ref:l,className:t()(s,a),controlId:i,...o,children:[n,(0,c.jsx)("label",{htmlFor:i,children:r})]})}));T.displayName="FloatingLabel";const L=T,V={_ref:i().any,validated:i().bool,as:i().elementType},z=r.forwardRef(((e,l)=>{let{className:a,validated:s,as:n="form",...i}=e;return(0,c.jsx)(n,{...i,ref:l,className:t()(a,s&&"was-validated")})}));z.displayName="Form",z.propTypes=V;const A=Object.assign(z,{Group:w,Control:g,Floating:k,Check:v,Switch:R,Label:S.Z,Text:P,Range:F,Select:Z,FloatingLabel:L})},4934:(e,l,a)=>{a.d(l,{Z:()=>s});const s=a(2791).createContext({})},1424:(e,l,a)=>{a.d(l,{Z:()=>m});var s=a(654),t=a.n(s),n=a(2791),i=(a(2391),a(162)),r=a(184);const c=n.forwardRef(((e,l)=>{const[{className:a,...s},{as:n="div",bsPrefix:c,spans:o}]=function(e){let{as:l,bsPrefix:a,className:s,...n}=e;a=(0,i.vE)(a,"col");const r=(0,i.pi)(),c=(0,i.zG)(),o=[],d=[];return r.forEach((e=>{const l=n[e];let s,t,i;delete n[e],"object"===typeof l&&null!=l?({span:s,offset:t,order:i}=l):s=l;const r=e!==c?"-".concat(e):"";s&&o.push(!0===s?"".concat(a).concat(r):"".concat(a).concat(r,"-").concat(s)),null!=i&&d.push("order".concat(r,"-").concat(i)),null!=t&&d.push("offset".concat(r,"-").concat(t))})),[{...n,className:t()(s,...o,...d)},{as:l,bsPrefix:a,spans:o}]}(e);return(0,r.jsx)(n,{...s,ref:l,className:t()(a,!o.length&&c)})}));c.displayName="Col";const o=c;var d=a(4934);const u=n.forwardRef(((e,l)=>{let{as:a="label",bsPrefix:s,column:c=!1,visuallyHidden:u=!1,className:m,htmlFor:p,...h}=e;const{controlId:f}=(0,n.useContext)(d.Z);s=(0,i.vE)(s,"form-label");let x="col-form-label";"string"===typeof c&&(x="".concat(x," ").concat(x,"-").concat(c));const b=t()(m,s,u&&"visually-hidden",c&&x);return p=p||f,c?(0,r.jsx)(o,{ref:l,as:"label",className:b,htmlFor:p,...h}):(0,r.jsx)(a,{ref:l,className:b,htmlFor:p,...h})}));u.displayName="FormLabel";const m=u}}]);
//# sourceMappingURL=837.a4a1e474.chunk.js.map